<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>Urho3D: Shaders</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Urho3D
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Shaders </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Urho3D uses an ubershader-like approach: permutations of each shader will be built with different defines, to produce eg. static or skinned, deferred or forward or shadowed/unshadowed rendering.</p>
<p>The building of these variations is controlled by an XML shader definition file, which always accompanies the shader source code.</p>
<p>For example, the Basic shader in Bin/CoreData/Shaders/HLSL has the following definition file:</p>
<div class="fragment"><div class="line">&lt;shaders&gt;</div>
<div class="line">    &lt;shader type=<span class="stringliteral">&quot;vs&quot;</span>&gt;</div>
<div class="line">        &lt;option name=<span class="stringliteral">&quot;Diff&quot;</span> define=<span class="stringliteral">&quot;DIFFMAP&quot;</span> /&gt;</div>
<div class="line">        &lt;option name=<span class="stringliteral">&quot;VCol&quot;</span> define=<span class="stringliteral">&quot;VERTEXCOLOR&quot;</span> /&gt;</div>
<div class="line">        &lt;variation name=<span class="stringliteral">&quot;&quot;</span> /&gt;</div>
<div class="line">        &lt;variation name=<span class="stringliteral">&quot;Skinned&quot;</span> define=<span class="stringliteral">&quot;SKINNED&quot;</span> /&gt;</div>
<div class="line">        &lt;variation name=<span class="stringliteral">&quot;Instanced&quot;</span> define=<span class="stringliteral">&quot;INSTANCED&quot;</span> require=<span class="stringliteral">&quot;SM3&quot;</span> /&gt;</div>
<div class="line">        &lt;variation name=<span class="stringliteral">&quot;Billboard&quot;</span> define=<span class="stringliteral">&quot;BILLBOARD&quot;</span> /&gt;</div>
<div class="line">    &lt;/shader&gt;</div>
<div class="line">    &lt;shader type=<span class="stringliteral">&quot;ps&quot;</span>&gt;</div>
<div class="line">        &lt;option name=<span class="stringliteral">&quot;Diff&quot;</span> define=<span class="stringliteral">&quot;DIFFMAP&quot;</span> exclude=<span class="stringliteral">&quot;Alpha&quot;</span> /&gt;</div>
<div class="line">        &lt;option name=<span class="stringliteral">&quot;Alpha&quot;</span> define=<span class="stringliteral">&quot;ALPHAMAP&quot;</span> exclude=<span class="stringliteral">&quot;Diff&quot;</span> /&gt;</div>
<div class="line">        &lt;option name=<span class="stringliteral">&quot;AlphaMask&quot;</span> define=<span class="stringliteral">&quot;ALPHAMASK&quot;</span> require=<span class="stringliteral">&quot;DIFFMAP&quot;</span> /&gt;</div>
<div class="line">        &lt;option name=<span class="stringliteral">&quot;VCol&quot;</span> define=<span class="stringliteral">&quot;VERTEXCOLOR&quot;</span> /&gt;</div>
<div class="line">    &lt;/shader&gt;</div>
<div class="line">&lt;/shaders&gt;</div>
</div><!-- fragment --><p>Permutations can be defined separately for both the vertex and the pixel shader. There exist two different mechanisms for adding permutations: a "variation" and an "option". A variation always excludes other variations within the same "variation group" and is most often used to define the geometry types for the vertex shader. In contrast, an option does not exclude other options by default.</p>
<p>For both variations and options, a name is required, and one or more defines to be passed to the shader compiler. If there is only one define, it can be listed as an attribute of the permutation, as shown. If many defines are needed, they can be included as child elements of the permutation, eg. (from the LitSolid shader)</p>
<div class="fragment"><div class="line">&lt;variation name=<span class="stringliteral">&quot;Dir&quot;</span>&gt;</div>
<div class="line">    &lt;define name=<span class="stringliteral">&quot;DIRLIGHT&quot;</span> /&gt;</div>
<div class="line">    &lt;define name=<span class="stringliteral">&quot;PERPIXEL&quot;</span> /&gt;</div>
<div class="line">&lt;/variation&gt;</div>
</div><!-- fragment --><p>A variation or option can "require" other defines, for example in HLSL shaders instancing requires the SM3 define which tells that we are compiling for Shader Model 3. Like defines, requires can be listed either as an attribute (if only one) or as a child element (if many.)</p>
<p>Additionally, an option can "include" or "exclude" other options. Use this mechanism instead of variations if complex dependencies between options is required, instead of simple exclusion. Again, includes or excludes can be listed either as attributes or child elements.</p>
<p>The final name of a shader permutation is formed by taking the shader's name, adding an underscore (if there are active variations/options) and then listing the names of all active variations/options in top-to-bottom order. For example the Basic vertex shader with vertex color and skinning active would be Basic_VColSkinned. This final name is used to request shaders from the <a class="el" href="a00235.html" title="High-level rendering subsystem. Manages drawing of 3D views.">Renderer</a> subsystem.</p>
<h1><a class="anchor" id="Shaders_Required"></a>
Required shader permutations</h1>
<p>When rendering scene objects, the engine expects certain shader permutations to exist for different geometry types and lighting conditions. These must appear in the specific order listed below. Use the LitSolid shader for reference.</p>
<p>Vertex shader:</p>
<ul>
<li>1VL, 2VL, 3VL, 4VL: number of vertex lights influencing the object</li>
<li>Dir, Spot, Point: a per-pixel forward light is being used</li>
<li>Spec: the per-pixel forward light has specular calculations</li>
<li>Shadow: the per-pixel forward light has shadowing</li>
<li>Skinned, Instanced, Billboard: choosing the geometry type</li>
</ul>
<p>Pixel shader:</p>
<ul>
<li>Dir, Spot, Point: a per-pixel forward light is being used</li>
<li>Mask: the point light has a cube map mask</li>
<li>Spec: the per-pixel forward light has specular calculations</li>
<li>Shadow: the per-pixel forward light has shadowing</li>
<li>LQ: use low-quality shadowing (1 hardware PCF sample instead of 4)</li>
<li>HW: use hardware shadow depth compare, Direct3D9 only</li>
</ul>
<h1><a class="anchor" id="Shaders_Writing"></a>
Writing shaders</h1>
<p>Shaders must be written separately for HLSL (Direct3D9) and GLSL (OpenGL). The built-in shaders try to implement the same functionality on both shader languages as closely as possible.</p>
<p>To get started with writing your own shaders, start with studying the most basic examples possible: the Basic, Shadow &amp; Unlit shaders. Note the required include files which bring common functionality, for example Uniforms.hlsl, Samplers.hlsl &amp; Transform.hlsl for HLSL shaders. Transforming the vertex (which hides the actual skinning, instancing or billboarding process) is a slight hack which uses a combination of macros and functions: it is safest to copy the following piece of code (for HLSL) verbatim:</p>
<div class="fragment"><div class="line">float4x3 modelMatrix = iModelMatrix;</div>
<div class="line">float3 worldPos = GetWorldPos(modelMatrix);</div>
<div class="line">oPos = GetClipPos(worldPos);</div>
</div><!-- fragment --><p>Note that for HLSL shaders both the vertex and the pixel shader are written into the same file, and the functions must be called VS() and PS(), while for GLSL they are put into separate .vert and .frag files, and are called main(). </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 20 2013 20:07:15 for Urho3D by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3.1
</small></address>
</body>
</html>
