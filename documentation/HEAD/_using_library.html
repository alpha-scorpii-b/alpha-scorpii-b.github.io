---
layout: documentation
group: HEAD
---
<div id="top">{% comment %}<!-- do not remove this div, it is closed by doxygen! -->{% endcomment %}
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Using Urho3D as external library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page shows how to create a new C++ project linking against Urho3D library as external library. There are two approaches to do this. The first approach uses Urho3D library directly from the Urho3D project build tree. The second approach uses Urho3D SDK installation. It is imperative to clean the CMake cache when changing from one approach to the other. In fact, you also need to clean the cache when you change the path in the URHO3D_HOME environment variable.</p>
<p>First of all, structure your project similar to Urho3D project as below, although this is not mandatory:</p>
<div class="fragment"><div class="line">PROJECT_ROOT/</div>
<div class="line"> ├ Android/ (<span class="keywordflow">for</span> Android platform)</div>
<div class="line"> ├ Bin/</div>
<div class="line"> │  ├ Data/</div>
<div class="line"> │  └ CoreData/</div>
<div class="line"> ├ CMake/</div>
<div class="line"> │  ├ Modules/</div>
<div class="line"> │  └ Toolchains/</div>
<div class="line"> ├ Docs/ (<span class="keywordflow">for</span> documentation)</div>
<div class="line"> ├ Source/ (<span class="keywordflow">for</span> large project)</div>
<div class="line"> ├ CMakeListst.txt</div>
<div class="line"> ├ *.cpp and *.h</div>
<div class="line"> └ *.bat or *.sh</div>
</div><!-- fragment --><p>The physical project root directory is also the logical project source tree in CMake terminology where your project main CMakeLists.txt should reside. The Bin directory should contain the Data and CoreData resource subdirs. Unless you intend to configure to use your project root directory as your project build tree as well, all the executables will not be actually generated in this Bin directory. The executables will always be generated in the Bin directory of the project build tree (which is now fully user defined). Therefore, in order to run the executable in the build tree's Bin directory, you need to copy (or symlink) the resource directories (Data and CoreData) from your source tree to your build tree. Alternatively, you can use URHO3D_PREFIX_PATH environment variable to point to a prefix path containing the resource dirs. Urho3D engine automatically uses this prefix path when obtaining resources. By default the engine uses the program executable path.</p>
<p>You may also want to copy (or symlink) the batch files or shell script files from Urho3D project root directory (or from Urho3D SDK installation) to your project root directory. The build scripts work together with the Urho3D CMake module to configure and generate your initial project build tree. Both out-of-source build tree (recommended) and non out-of-source build tree are now supported. Note that when you invoke one the build scripts for your project, you can also pass most of the <a class="el" href="_building.html#Build_Options">build options</a> supported by Urho3D project. In fact, you probably have to pass the similar build options that you use when building the Urho3D library to avoid any conflict.</p>
<p>In your own project root directory, create a main CMakeLists.txt file and add the following lines: (replace MyProjectName and MyExecutableName with the actual names you want)</p>
<div class="fragment"><div class="line"><span class="preprocessor"># Set project name</span></div>
<div class="line"><span class="preprocessor"></span>project (MyProjectName)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set minimum version</span></div>
<div class="line"><span class="preprocessor"></span>cmake_minimum_required (VERSION 2.8.6)</div>
<div class="line"></div>
<div class="line">if (COMMAND cmake_policy)</div>
<div class="line">    cmake_policy (SET CMP0003 NEW)</div>
<div class="line">    if (CMAKE_VERSION VERSION_GREATER 2.8.12 OR CMAKE_VERSION VERSION_EQUAL 2.8.12)</div>
<div class="line">        <span class="preprocessor"># INTERFACE_LINK_LIBRARIES defines the link interface</span></div>
<div class="line"><span class="preprocessor"></span>        cmake_policy (SET CMP0022 NEW)</div>
<div class="line">    endif ()</div>
<div class="line">    if (CMAKE_VERSION VERSION_GREATER 3.0.0 OR CMAKE_VERSION VERSION_EQUAL 3.0.0)</div>
<div class="line">        <span class="preprocessor"># Disallow use of the LOCATION target property - therefore we set to OLD as we still need it</span></div>
<div class="line"><span class="preprocessor"></span>        cmake_policy (SET CMP0026 OLD)</div>
<div class="line">        <span class="preprocessor"># MACOSX_RPATH is enabled by default</span></div>
<div class="line"><span class="preprocessor"></span>        cmake_policy (SET CMP0042 NEW)</div>
<div class="line">    endif ()</div>
<div class="line">endif ()</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Set CMake modules search path</span></div>
<div class="line"><span class="preprocessor"></span><span class="keyword">set</span> (CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/CMake/Modules)</div>
<div class="line"></div>
<div class="line"># Include Urho3D Cmake common module</div>
<div class="line">include (Urho3D-CMake-common)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Find Urho3D library</span></div>
<div class="line"><span class="preprocessor"></span>find_package (Urho3D REQUIRED)</div>
<div class="line">include_directories (${URHO3D_INCLUDE_DIRS})</div>
<div class="line"></div>
<div class="line"># Define target name</div>
<div class="line"><span class="keyword">set</span> (TARGET_NAME MyExecutableName)</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Define source files</span></div>
<div class="line"><span class="preprocessor"></span>define_source_files ()</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># Setup target with resource copying</span></div>
<div class="line"><span class="preprocessor">setup_main_executable ()</span></div>
</div><!-- fragment --><p>The CMAKE_MODULE_PATH is setup so that CMake can find the Urho3D-specific CMake modules provided by Urho3D project inside your own project. The Urho3D-CMake-common.cmake is the module where all the reusable commands and macros are defined. It also gives your project cross-platform build capability similar to Urho3D project.</p>
<p>When both Urho3D static and shared library are built and available in the Urho3D project's library output directory in its build tree, the FindUrho3D.cmake module has precedence to first select static library type over over shared library type. However, you can use URHO3D_LIB_TYPE build option to explicitly specify which Urho3D library type to be selected. When linking statically against Urho3D static library, Urho3D-CMake-common.cmake module automatically set "URHO3D_STATIC_DEFINE" compiler define for your project. This compiler define is crucial for static linking, especially on MSVC.</p>
<p>As described earlier there are two approaches on how to find the Urho3D library. The FindUrho3D.cmake module is designed not only able to find Urho3D library from the Urho3D SDK installation, but also from any Urho3D project build tree directly. When searching in Urho3D SDK installed in a system-wide default location then no additional variable need to be set. When searching in a non-default SDK installation or when searching in any Urho3D project build tree then the actual location need to be provided via URHO3D_HOME environment variable (set in the host system) or URHO3D_HOME build option (set using -D at command line).</p>
<p>The define_source_files() and setup_main_executable() are Urho3D-specific macros. The define_source_file() macro is a shorthand to glob all the source files in the current directory. It is equivalent to these commands:</p>
<div class="fragment"><div class="line">file (GLOB CPP_FILES *.cpp)</div>
<div class="line">file (GLOB H_FILES *.h)</div>
<div class="line"><span class="keyword">set</span> (SOURCE_FILES ${CPP_FILES} ${H_FILES})</div>
</div><!-- fragment --><p>The setup_main_executable() macro then uses SOURCE_FILES and TARGET_NAME variables to setup a new CMake target that would work on ALL platforms supported by Urho3D. Make sure both your project name and target name are not called 'Urho3D', as this name is reserved for Urho3D project only.</p>
<h2><a class="anchor" id="FromSDKWithPkgConfig"></a>
Using pkg-config instead of CMake</h2>
<p>If for some reason you could not use CMake in your project, you could configure your project to compile and link against Urho3D library from SDK installation using 'pkg-config' tool with the help of 'Urho3D.pc' configuration file (which is installed as part of the SDK installation). If the Urho3D SDK is being installed into a local location (such as /usr/local) or a non-default location, then most likely you would need to specify PKG_CONFIG_PATH environment variable to point to the location of the configuration file for this to work. The 'Urho3D.pc' file contains important information on how to configure your compiler and linker correctly. You can use that information as a reference to configure your own project even when you do not use 'pkg-config' tool.</p>
<p>Below are a few invocation examples on a 64-bit RedHat-based distro with local installation:</p>
<div class="fragment"><div class="line"><span class="preprocessor"># To get installed Urho3D version</span></div>
<div class="line"><span class="preprocessor"></span>PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig pkg-config --modversion Urho3D</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># To compile and link natively in one liner</span></div>
<div class="line"><span class="preprocessor"></span>c++ -o Urho3DPlayer Urho3DPlayer.cpp `PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig pkg-config --cflags --libs Urho3D`</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># To compile and link natively but in separate steps</span></div>
<div class="line"><span class="preprocessor"></span>export PKG_CONFIG_PATH=/usr/local/lib64/pkgconfig</div>
<div class="line">c++ -c Urho3DPlayer.cpp `pkg-config --cflags Urho3D`</div>
<div class="line">c++ -o Urho3DPlayer Urho3DPlayer.o `pkg-config --libs Urho3D`</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># To cross-compile and link for Raspberry Pi platform</span></div>
<div class="line"><span class="preprocessor"></span>export CC=${RPI_PREFIX}-c++</div>
<div class="line">export PKG_CONFIG_SYSROOT_DIR=${RPI_SYSROOT}</div>
<div class="line">export PKG_CONFIG_PATH=${RPI_SYSROOT}/usr/local/lib/pkgconfig</div>
<div class="line">$CC -o Urho3DPlayer Urho3DPlayer.cpp `pkg-config --cflags --libs Urho3D`</div>
<div class="line"></div>
<div class="line"><span class="preprocessor"># To cross-compile and link for Windows platform using MinGW cross-compiler (in Debug configuration)</span></div>
<div class="line"><span class="preprocessor"></span>export CC=${MINGW_PREFIX}-c++</div>
<div class="line">export PKG_CONFIG_SYSROOT_DIR=${MINGW_SYSROOT}</div>
<div class="line">export PKG_CONFIG_PATH=${MINGW_SYSROOT}/usr/local/lib/pkgconfig</div>
<div class="line">$CC -o Urho3DPlayer_d.exe Urho3DPlayer.cpp `pkg-config --variable CFLAGS_DEBUG Urho3D` `pkg-config --cflags --libs Urho3D`</div>
</div><!-- fragment --><h2><a class="anchor" id="Scaffolding"></a>
Project scaffolding</h2>
<p>With <a href="https://rubygems.org/gems/rake">Rake</a> ruby gem installed, you can quickly setup all the above by simply using the 'scaffolding' rake task. </p>
<pre class="fragment">Usage: rake scaffolding dir=/path/to/new/project/root [project=Scaffolding] [target=Main]
</pre><p>As its name implies, this task just creates a basic project structure for your new project. You may also pass optional "project" and "target" parameters besides the "dir" parameter. Otherwise, you will get the default project name (Scaffolding) and target name (Main) in the main CMakeLists.txt. This task copies the Urho3DPlayer.cpp and Urho3DPlayer.h as placeholders for the source files. Normally, you should replace these two files with your own project source files before invoking one of the build scripts.</p>
<p>On Windows host system, this task requires privilege to create symlinks by using mklink command. The task would fail when the Windows user account does not have that privilege. We strongly advise you not to use "Administrator" account just for this purpose. Instead, grant your "normal" user account to have the privilege correctly.</p>
<p>WARNING: As of this writing, this rake scaffolding task does not yet create a complete new project suitable for Android platform. You need to supply the missing bits manually yourself for now. </p>
</div></div><!-- contents -->
