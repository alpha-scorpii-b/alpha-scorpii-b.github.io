---
layout: page
title: Documentation
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.3.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Render path </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Scene rendering and any post-processing on a <a class="el" href="a00374.html" title="Viewport definition either for a render surface or the backbuffer.">Viewport</a> is defined by its <a class="el" href="a00281.html" title="Rendering path definition.">RenderPath</a> object, which can either be read from an XML file or be created programmatically.</p>
<p>The render path consists of rendertarget definitions and commands. The commands are executed in order to yield the rendering result. Each command outputs either to the destination rendertarget &amp; viewport (default if output definition is omitted), or one of the named rendertargets. MRT output is also possible.</p>
<p>A rendertarget's size can be either absolute, divide the destination viewport size, or divide the destination rendertarget size. Furthermore, a rendertarget can be declared "persistent" so that it will not be mixed with other rendertargets of the same size and format, and its contents can be assumed to be available also on subsequent frames. For examples of rendertarget definitions, see the postprocess renderpath definitions in the Bin/Data/PostProcess directory.</p>
<p>The available commands are:</p>
<ul>
<li>clear: Clear any of color, depth and stencil. <a class="el" href="a00102.html" title="RGBA color.">Color</a> clear can optionally use the fog color from the <a class="el" href="a00385.html" title="Component that describes global rendering properties">Zone</a> visible at the far clip distance.</li>
<li>scenepass: Render scene objects whose <a class="el" href="a00021.html">material technique</a> contains the specified pass. Will either be front-to-back ordered with state sorting, or back-to-front ordered with no state sorting. For deferred rendering, object lightmasks can be optionally marked to the stencil buffer. Vertex lights can optionally be handled during a pass, if it has the necessary shader combinations. Textures global to the pass can be bound to free texture units; these can either be the viewport, a named rendertarget, or a 2D texture resource identified with its pathname.</li>
<li>quad: Render a viewport-sized quad using the specified shaders and compilation defines. Textures can be bound and additionally shader parameters can be specified.</li>
<li>forwardlights: Render per-pixel forward lighting for opaque objects with the specified pass name. Shadow maps are also rendered as necessary.</li>
<li>lightvolumes: Render deferred light volumes using the specified shaders. G-buffer textures can be bound as necessary.</li>
</ul>
<p>A render path can be loaded from a main XML file by calling <a class="el" href="a00281.html#ae776419ac8a09772b9946f8d866cb6db">Load()</a>, after which other XML files (for example one for each post-processing effect) can be appended to it by calling <a class="el" href="a00281.html#a83dc9a84e0ef778f2165bcc76d2f6634">Append()</a>. Rendertargets and commands can be enabled or disabled by calling <a class="el" href="a00281.html#a37daf20b9186850fa60e36a5fef5abe3">SetEnabled()</a> to switch eg. a post-processing effect on or off. To aid in this, both can be identified by tag names, for example the bloom effect uses the tag "Bloom" for all of its rendertargets and commands.</p>
<p>It is legal to both write to the destination viewport and sample from it during the same command: pingpong copies of its contents will be made automatically. If the viewport has hardware multisampling on, the multisampled backbuffer will be resolved to a texture before sampling it.</p>
<p>The render path XML definition looks like this:</p>
<div class="fragment"><div class="line">&lt;renderpath&gt;</div>
<div class="line">    &lt;rendertarget name=<span class="stringliteral">&quot;RTName&quot;</span> tag=<span class="stringliteral">&quot;TagName&quot;</span> enabled=<span class="stringliteral">&quot;true|false&quot;</span> size=<span class="stringliteral">&quot;x y&quot;</span>|sizedivisor=<span class="stringliteral">&quot;x y&quot;</span>|rtsizedivisor=<span class="stringliteral">&quot;x y&quot;</span></div>
<div class="line">        format=<span class="stringliteral">&quot;rgb|rgba|r32f|rgba16|rgba16f|rgba32f|rg16|rg16f|rg32f|lineardepth&quot;</span> filter=<span class="stringliteral">&quot;true|false&quot;</span> srgb=<span class="stringliteral">&quot;true|false&quot;</span> persistent=<span class="stringliteral">&quot;true|false&quot;</span> /&gt;</div>
<div class="line">    &lt;command type=<span class="stringliteral">&quot;clear&quot;</span> tag=<span class="stringliteral">&quot;TagName&quot;</span> enabled=<span class="stringliteral">&quot;true|false&quot;</span> clearcolor=<span class="stringliteral">&quot;r g b a|fog&quot;</span> cleardepth=<span class="stringliteral">&quot;x&quot;</span> clearstencil=<span class="stringliteral">&quot;y&quot;</span> output=<span class="stringliteral">&quot;viewport|RTName&quot;</span> /&gt;</div>
<div class="line">    &lt;command type=<span class="stringliteral">&quot;scenepass&quot;</span> pass=<span class="stringliteral">&quot;PassName&quot;</span> sort=<span class="stringliteral">&quot;fronttoback|backtofront&quot;</span> marktostencil=<span class="stringliteral">&quot;true|false&quot;</span> vertexlights=<span class="stringliteral">&quot;true|false&quot;</span> metadata=<span class="stringliteral">&quot;base|alpha|gbuffer&quot;</span> &gt;</div>
<div class="line">        &lt;output index=<span class="stringliteral">&quot;0&quot;</span> name=<span class="stringliteral">&quot;RTName1&quot;</span> /&gt;</div>
<div class="line">        &lt;output index=<span class="stringliteral">&quot;1&quot;</span> name=<span class="stringliteral">&quot;RTName2&quot;</span> /&gt;</div>
<div class="line">        &lt;output index=<span class="stringliteral">&quot;2&quot;</span> name=<span class="stringliteral">&quot;RTName3&quot;</span> /&gt;</div>
<div class="line">        &lt;texture unit=<span class="stringliteral">&quot;unit&quot;</span> name=<span class="stringliteral">&quot;viewport|RTName|TextureName&quot;</span> /&gt;</div>
<div class="line">    &lt;/command&gt;</div>
<div class="line">    &lt;command type=<span class="stringliteral">&quot;quad&quot;</span> vs=<span class="stringliteral">&quot;VertexShaderName&quot;</span> ps=<span class="stringliteral">&quot;PixelShaderName&quot;</span> vsdefines=<span class="stringliteral">&quot;DEFINE1 DEFINE2&quot;</span> psdefines=<span class="stringliteral">&quot;DEFINE3 DEFINE4&quot;</span> output=<span class="stringliteral">&quot;viewport|RTName&quot;</span> /&gt;</div>
<div class="line">        &lt;texture unit=<span class="stringliteral">&quot;unit&quot;</span> name=<span class="stringliteral">&quot;viewport|RTName|TextureName&quot;</span> /&gt;</div>
<div class="line">        &lt;parameter name=<span class="stringliteral">&quot;ParameterName&quot;</span> value=<span class="stringliteral">&quot;x y z w&quot;</span> /&gt;</div>
<div class="line">    &lt;/command&gt;</div>
<div class="line">    &lt;command type=<span class="stringliteral">&quot;forwardlights&quot;</span> pass=<span class="stringliteral">&quot;PassName&quot;</span> uselitbase=<span class="stringliteral">&quot;true|false&quot;</span> output=<span class="stringliteral">&quot;viewport|RTName&quot;</span> /&gt;</div>
<div class="line">    &lt;command type=<span class="stringliteral">&quot;lightvolumes&quot;</span>  vs=<span class="stringliteral">&quot;VertexShaderName&quot;</span> ps=<span class="stringliteral">&quot;PixelShaderName&quot;</span> output=<span class="stringliteral">&quot;viewport|RTName&quot;</span> /&gt;</div>
<div class="line">        &lt;texture unit=<span class="stringliteral">&quot;unit&quot;</span> name=<span class="stringliteral">&quot;viewport|RTName|TextureName&quot;</span> /&gt;</div>
<div class="line">    &lt;/command&gt;</div>
<div class="line">&lt;/renderpath&gt;</div>
</div><!-- fragment --><p>Note the special "lineardepth" format available for rendertargets. This is intended for storing scene depth in deferred rendering. It will be D3DFMT_R32F on Direct3D9, but RGBA on OpenGL, due to the limitation of all color buffers having to be the same format. The shader include file Samplers.glsl in Bin/CoreData/Shaders/GLSL provides functions to encode and decode linear depth to RGB.</p>
<h1><a class="anchor" id="RenderPaths_ForwardLighting"></a>
Forward lighting special considerations</h1>
<p>Otherwise fully customized scene render passes can be specified, but there are a few things to remember related to forward lighting:</p>
<ul>
<li>The opaque base pass must be tagged with metadata "base". When forward lighting logic does the lit base pass optimization, it will search for a pass with the word "lit" prepended, ie. if your custom opaque base pass is called "custombase", the corresponding lit base pass would be "litcustombase".</li>
<li>The transparent base pass must be tagged with metadata "alpha". For lit transparent objects, the forward lighting logic will look for a pass with the word "lit" prepended, ie. if the custom alpha base pass is called "customalpha", the corresponding lit pass is "litcustomalpha". The lit drawcalls will be interleaved with the transparent base pass, and the scenepass command should have back-to-front sorting enabled.</li>
<li>If forward and deferred lighting are mixed, the G-buffer writing pass must be tagged with metadata "gbuffer" to prevent geometry being double-lit also with forward lights.</li>
<li>Remember to mark the lighting mode (per-vertex / per-pixel) into the techniques which define custom passes, as the lighting mode can be guessed automatically only for the known default passes.</li>
<li>The forwardlights command can optionally disable the lit base pass optimization without having to touch the material techniques, if a separate opaque ambient-only base pass is needed. By default the optimization is enabled.</li>
</ul>
<h1><a class="anchor" id="RenderPaths_PostProcess"></a>
Post-processing effects special considerations</h1>
<p>Post-processing effects are usually implemented by using the quad command. When using intermediate rendertargets that are of different size than the viewport rendertarget, it is necessary in shaders to reference their (inverse) size and the half-pixel offset for Direct3D9. These shader uniforms are automatically generated for named rendertargets. For an example look at the bloom postprocess shaders: the rendertarget called HBlur will define the shader uniforms cHBlurInvSize and cHBlurOffsets (both <a class="el" href="a00364.html" title="Two-dimensional vector.">Vector2</a>.)</p>
<p>In OpenGL post-processing shaders it is important to distinguish between sampling a rendertarget texture and a regular texture resource, because intermediate rendertargets (such as the G-buffer) may be vertically inverted. Use the GetScreenPos() or GetQuadTexCoord() functions to get rendertarget UV coordinates from the clip coordinates; this takes flipping into account automatically. For sampling a regular texture, use GetQuadTexCoordNoFlip() function, which requires world coordinates instead of clip coordinates. </p>
</div></div><!-- contents -->
